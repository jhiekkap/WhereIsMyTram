{"ast":null,"code":"var _jsxFileName = \"/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { setShowTrams } from '../reducers/showTramsReducer';\nimport { setMyTram } from '../reducers/myTramReducer';\nimport { setCenter } from '../reducers/centerReducer';\nimport { setZoom } from '../reducers/zoomReducer';\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet';\nimport { Button } from 'react-bootstrap';\nimport driverIcon, { stopIcon, myStopIcon, myTramIcon } from '../utils/icons';\n\nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  showSidebar,\n  showSidebarOpenButton,\n  center,\n  setCenter,\n  zoom,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram\n}) => {\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value);\n    let chosenTram = trams.find(tram => tram.VP.veh === e.target.value);\n    setMyTram(chosenTram);\n    setShowTrams([]);\n    setCenter({\n      lat: chosenTram.VP.lat,\n      lng: chosenTram.VP.long\n    });\n    setZoom(16);\n  };\n\n  const popUp = tram => {\n    return React.createElement(Popup, {\n      closeButton: true,\n      value: tram.VP.veh,\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44\n      },\n      __self: this\n    }, \"line:\", tram.VP.desi, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50\n      },\n      __self: this\n    }), \"vehicle:\", tram.VP.veh, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }), \"speed:\", (tram.VP.spd * 3.6).toFixed(2), \" km/h\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 54\n      },\n      __self: this\n    }), \"stop:\", tram.VP.stop, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }), \"route:\", tram.VP.route, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58\n      },\n      __self: this\n    }), tram.VP.dl > 0 ? 'ahead ' : 'lagging ', \" \", Math.abs(tram.VP.dl), \" seconds\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60\n      },\n      __self: this\n    }), tram.VP.drst === 0 ? 'doors closed' : 'doors open', React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }), (!myTram.VP || myTram.VP && myTram.VP.veh !== tram.VP.veh) && React.createElement(Button, {\n      onClick: () => handleChooseTram,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 63\n      },\n      __self: this\n    }, \"CHOOSE\"));\n  };\n\n  const ShowChosenTrams = () => {\n    let tramsToShow = [...trams].filter(tram => showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh));\n\n    if (myTram.VP) {\n      tramsToShow = tramsToShow.filter(tram => tram.VP.veh !== myTram.VP.veh);\n    }\n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => React.createElement(Marker, {\n        key: i,\n        position: {\n          lat: tram.VP.lat,\n          lng: tram.VP.long\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      }, popUp(tram)));\n    }\n  };\n\n  const showMyTram = () => {\n    if (myTram.VP) {\n      let myTramAlive = trams.find(tram => tram.VP.veh === myTram.VP.veh);\n      return React.createElement(Marker, {\n        icon: myTramIcon,\n        position: {\n          lat: myTramAlive.VP.lat,\n          lng: myTramAlive.VP.long\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      }, popUp(myTramAlive));\n    }\n  };\n\n  const showStops = () => {\n    return stops && stops.map((stop, i) => React.createElement(Marker, {\n      onClick: () => {\n        setMyStop(stop);\n      },\n      key: i,\n      icon: stop.id === myStop.id ? myStopIcon : stopIcon,\n      position: {\n        lat: stop.lat,\n        lng: stop.lon\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, React.createElement(Popup, {\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }), \" \", stop.name, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }), \" \", stop.gtfsId)));\n  };\n\n  const style = showSidebar ? {\n    marginLeft: '20px'\n  } : {\n    marginLeft: '0'\n  };\n  return React.createElement(\"div\", {\n    id: \"map\",\n    style: style,\n    title: \"Double-click map to set a new center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, showSidebarOpenButton && React.createElement(Button, {\n    variant: \"light\",\n    style: {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      zIndex: 1,\n      fontSize: 36,\n      marginTop: '4px',\n      display: showSidebar ? 'none' : ''\n    },\n    onClick: () => openSidebar(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, showSidebarOpenButton ? '☰' : ''), React.createElement(Map, {\n    id: \"map\",\n    center: myTram.VP ? {\n      lat: trams.find(tram => tram.VP.veh === myTram.VP.veh).VP.lat,\n      lng: trams.find(tram => tram.VP.veh === myTram.VP.veh).VP.long\n    } : center,\n    zoom: zoom,\n    onclick: () => closeSidebar(),\n    zoomControl: false,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(TileLayer, {\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    attribution: \"\\xA9 <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }), ShowChosenTrams(), showStops(), showMyTram(), React.createElement(Marker, {\n    icon: driverIcon,\n    position: {\n      lat: 60.170627,\n      lng: 24.939946\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, React.createElement(Popup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \"We are here! \", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }), \" This is our position!\"))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    center: state.center,\n    zoom: state.zoom,\n    myStop: state.myStop,\n    myTram: state.myTram\n  };\n};\n\nconst mapDispatchToProps = {\n  setShowTrams,\n  setMyStop,\n  setMyTram,\n  setZoom,\n  setCenter\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LeafletMap);","map":{"version":3,"sources":["/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js"],"names":["React","connect","setShowTrams","setMyTram","setCenter","setZoom","setMyStop","Map","Marker","Popup","TileLayer","Button","driverIcon","stopIcon","myStopIcon","myTramIcon","LeafletMap","trams","showTrams","openSidebar","closeSidebar","showSidebar","showSidebarOpenButton","center","zoom","stops","myStop","myTram","handleChooseTram","e","console","log","target","value","chosenTram","find","tram","VP","veh","lat","lng","long","popUp","desi","spd","toFixed","stop","route","dl","Math","abs","drst","ShowChosenTrams","tramsToShow","filter","map","includes","i","showMyTram","myTramAlive","showStops","id","lon","name","gtfsId","style","marginLeft","position","top","left","zIndex","fontSize","marginTop","display","mapStateToProps","state","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { setShowTrams } from '../reducers/showTramsReducer'\nimport { setMyTram } from '../reducers/myTramReducer'\nimport { setCenter } from '../reducers/centerReducer'\nimport { setZoom } from '../reducers/zoomReducer'\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet'\nimport { Button } from 'react-bootstrap' \nimport driverIcon, { stopIcon, myStopIcon, myTramIcon } from '../utils/icons'\n  \nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  showSidebar,\n  showSidebarOpenButton,\n  center,\n  setCenter,\n  zoom,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram,\n}) => {\n\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value)\n    let chosenTram = trams.find(tram => tram.VP.veh === e.target.value)\n    setMyTram(chosenTram)\n    setShowTrams([])\n    setCenter({ lat: chosenTram.VP.lat, lng: chosenTram.VP.long })\n    setZoom(16)\n\n  }\n \n\n  const popUp = tram => {\n    return (\n      <Popup\n        closeButton={true}\n        value={tram.VP.veh}\n        autoPan={false}\n      >\n        line:{tram.VP.desi}\n        <br />\n        vehicle:{tram.VP.veh}\n        <br />\n        speed:{(tram.VP.spd * 3.6).toFixed(2)} km/h\n        <br />\n        stop:{tram.VP.stop}\n        <br />\n        route:{tram.VP.route}\n        <br />\n        {tram.VP.dl > 0 ? 'ahead ' : 'lagging '} {Math.abs(tram.VP.dl)} seconds\n        <br />\n        {tram.VP.drst === 0 ? 'doors closed' : 'doors open'}\n        <br />\n        {(!myTram.VP || (myTram.VP && myTram.VP.veh !== tram.VP.veh)) && <Button   onClick={() => handleChooseTram}>CHOOSE</Button>}\n      </Popup>\n    )\n  }\n\n  const ShowChosenTrams = () => {\n\n    let tramsToShow = [...trams].filter(tram =>\n      showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh)\n    )\n    if (myTram.VP) {\n      tramsToShow = tramsToShow.filter(tram => tram.VP.veh !== myTram.VP.veh)\n    }\n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => (\n        <Marker\n          key={i}\n          position={{\n            lat: tram.VP.lat,\n            lng: tram.VP.long,\n          }}\n        >\n          {popUp(tram)}\n        </Marker>\n      ))\n    }\n  }\n\n  const showMyTram = () => {\n    if (myTram.VP) {\n      let myTramAlive = trams.find(tram => tram.VP.veh === myTram.VP.veh)\n      return (\n        <Marker\n          icon={myTramIcon}\n          position={{ lat: myTramAlive.VP.lat, lng: myTramAlive.VP.long }}\n        >\n          {popUp(myTramAlive)}\n        </Marker>\n      )\n    }\n  }\n\n  const showStops = () => {\n\n    return stops &&\n    stops.map((stop, i) => (\n      <Marker\n        onClick={() => { setMyStop(stop) }}\n        key={i}\n        icon={stop.id === myStop.id ? myStopIcon : stopIcon}\n        position={{ lat: stop.lat, lng: stop.lon }}\n      >\n        <Popup autoPan={false}>\n          <br /> {stop.name}\n          <br /> {stop.gtfsId}\n        </Popup>\n      </Marker>\n    ))\n  }\n\n  const style = showSidebar ? { marginLeft: '20px' } : { marginLeft: '0' }\n\n  return (\n    <div id='map' style={style} title='Double-click map to set a new center'>\n      {showSidebarOpenButton && (\n        <Button\n          variant='light'\n          style={{\n            position: 'fixed',\n            top: 0,\n            left: 0,\n            zIndex: 1,\n            fontSize: 36,\n            marginTop: '4px',\n            display: showSidebar ? 'none' : '',\n          }}\n          onClick={() => openSidebar()}\n        >\n          {showSidebarOpenButton ? '☰' : ''}\n        </Button>\n      )}\n      <Map\n        id='map'\n        center={myTram.VP ? {lat:trams.find(tram => tram.VP.veh === myTram.VP.veh).VP.lat, lng:trams.find(tram => tram.VP.veh === myTram.VP.veh).VP.long} : center}\n        zoom={zoom}\n        onclick={() => closeSidebar()}\n        zoomControl={false}\n      >\n        <TileLayer\n          url='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        />\n        {ShowChosenTrams()}\n        {showStops()}\n        {showMyTram()}\n        <Marker\n          icon={driverIcon}\n          position={{ lat: 60.170627, lng: 24.939946 }}\n        >\n          <Popup>\n            We are here! <br /> This is our position!\n          </Popup>\n        </Marker>\n      </Map>\n    </div>\n  )\n}\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    center: state.center,\n    zoom: state.zoom,\n    myStop: state.myStop,\n    myTram: state.myTram,\n  }\n}\n\nconst mapDispatchToProps = {\n  setShowTrams,\n  setMyStop, setMyTram,setZoom,setCenter,\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LeafletMap)\n"]},"metadata":{},"sourceType":"module"}