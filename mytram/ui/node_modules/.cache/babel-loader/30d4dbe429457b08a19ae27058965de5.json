{"ast":null,"code":"var _jsxFileName = \"/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { setShowTrams } from '../reducers/showTramsReducer';\nimport { setMyTram } from '../reducers/myTramReducer';\nimport { setCenter, setZoom, setShowAlert, openSidebar, closeSidebar, toggleAlertVariant } from '../reducers/settingsReducer';\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet';\nimport { Button, Alert } from 'react-bootstrap';\nimport driverIcon, { stopIcon, myStopIcon, tramIcon, myTramIcon, locationIcon } from '../utils/icons';\n\nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  setCenter,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram,\n  settings,\n  setShowAlert\n}) => {\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value);\n    let chosenTram = trams.find(tram => tram.VP.veh == e.target.value); //setShowTrams([])\n\n    setMyTram(chosenTram);\n\n    if (!showTrams.map(tram => tram.VP.veh).includes(choseTram.VP.veh)) {\n      setShowTrams(showTrams.concat(chose));\n    } //setCenter({ lat: chosenTram.VP.lat, lng: chosenTram.VP.long })\n    //setZoom(16)\n\n  };\n\n  const popUp = tram => {\n    return React.createElement(Popup, {\n      closeButton: true,\n      value: tram.VP.veh,\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 43\n      },\n      __self: this\n    }, \"line:\", tram.VP.desi, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49\n      },\n      __self: this\n    }), \"vehicle:\", tram.VP.veh, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }), \"speed:\", (tram.VP.spd * 3.6).toFixed(2), \" km/h\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 53\n      },\n      __self: this\n    }), \"stop:\", tram.VP.stop, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55\n      },\n      __self: this\n    }), \"route:\", tram.VP.route, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57\n      },\n      __self: this\n    }), tram.VP.dl > 0 ? 'ahead ' : 'lagging ', \" \", Math.abs(tram.VP.dl), \" seconds\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 59\n      },\n      __self: this\n    }), tram.VP.drst === 0 ? 'doors closed' : 'doors open', React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61\n      },\n      __self: this\n    }), (!myTram.VP || myTram.VP && myTram.VP.veh !== tram.VP.veh) && React.createElement(Button, {\n      value: tram.VP.veh,\n      onClick: handleChooseTram,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }, \"CHOOSE\"));\n  };\n\n  const ShowChosenTrams = () => {\n    let tramsToShow = [...trams].filter(tram => showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh));\n\n    if (myTram.VP) {\n      tramsToShow = tramsToShow.filter(tram => tram.VP.veh !== myTram.VP.veh);\n    }\n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => React.createElement(Marker, {\n        key: i,\n        icon: myTram.Vp ? myTramIcon : tramIcon,\n        position: {\n          lat: tram.VP.lat,\n          lng: tram.VP.long\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }, popUp(tram)));\n    }\n  };\n\n  const showMyTram = () => {\n    if (myTram.VP) {\n      let myTramAlive = trams.find(tram => tram.VP.veh === myTram.VP.veh);\n      let halfWay = {\n        lat: (myStop.lat + myTramAlive.VP.lat) / 2,\n        lng: (myStop.lon + myTramAlive.VP.long) / 2\n      };\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, React.createElement(Marker, {\n        icon: myTramIcon,\n        position: {\n          lat: myTramAlive.VP.lat,\n          lng: myTramAlive.VP.long\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, popUp(myTramAlive)));\n    }\n  };\n\n  const showStops = () => {\n    return stops && stops.map((stop, i) => React.createElement(Marker, {\n      onClick: () => setMyStop(stop),\n      key: i,\n      icon: stop.id === myStop.id ? myStopIcon : stopIcon,\n      position: {\n        lat: stop.lat,\n        lng: stop.lon\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(Popup, {\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }), \" \", stop.name, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }), \" \", stop.gtfsId)));\n  };\n\n  const style = settings.showSidebar ? {\n    marginLeft: '20px'\n  } : {\n    marginLeft: '0'\n  };\n  return React.createElement(\"div\", {\n    id: \"mapContainer\",\n    style: style,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, settings.showSidebarOpenButton && React.createElement(Button, {\n    variant: \"light\",\n    style: {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      zIndex: 1,\n      fontSize: 36,\n      marginTop: '4px',\n      display: settings.showSidebar ? 'none' : ''\n    },\n    onClick: () => openSidebar(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, settings.showSidebarOpenButton ? 'â˜°' : ''), !settings.showAlert && React.createElement(Map, {\n    id: \"map\",\n    center: settings.center,\n    zoom: settings.zoom,\n    onclick: () => closeSidebar(),\n    zoomControl: false,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(TileLayer, {\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    attribution: \"\\xA9 <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }), ShowChosenTrams(), showStops(), React.createElement(Marker, {\n    icon: driverIcon,\n    position: {\n      lat: 60.170627,\n      lng: 24.939946\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, React.createElement(Popup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, \"We are here! \", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }), \" This is our position!\"))), React.createElement(Alert, {\n    id: \"alert\",\n    show: settings.showAlert,\n    variant: settings.alertVariant ? 'danger' : 'warning',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), React.createElement(Alert.Heading, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, \"How's it going?!\"), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"Duis mollis, est non commodo luctus\"), React.createElement(\"hr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"d-flex justify-content-end\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: () => setShowAlert(false),\n    variant: \"warning\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }, \"Close me ya'll!\"))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    //showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    settings: state.settings,\n    myStop: state.myStop,\n    myTram: state.myTram\n  };\n};\n\nconst mapDispatchToProps = {\n  setShowTrams,\n  setMyStop,\n  setMyTram,\n  setZoom,\n  setCenter,\n  setShowAlert,\n  openSidebar,\n  closeSidebar\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LeafletMap);","map":{"version":3,"sources":["/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js"],"names":["React","connect","setShowTrams","setMyTram","setCenter","setZoom","setShowAlert","openSidebar","closeSidebar","toggleAlertVariant","setMyStop","Map","Marker","Popup","TileLayer","Button","Alert","driverIcon","stopIcon","myStopIcon","tramIcon","myTramIcon","locationIcon","LeafletMap","trams","showTrams","stops","myStop","myTram","settings","handleChooseTram","e","console","log","target","value","chosenTram","find","tram","VP","veh","map","includes","choseTram","concat","chose","popUp","desi","spd","toFixed","stop","route","dl","Math","abs","drst","ShowChosenTrams","tramsToShow","filter","i","Vp","lat","lng","long","showMyTram","myTramAlive","halfWay","lon","showStops","id","name","gtfsId","style","showSidebar","marginLeft","showSidebarOpenButton","position","top","left","zIndex","fontSize","marginTop","display","showAlert","center","zoom","alertVariant","mapStateToProps","state","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { setShowTrams } from '../reducers/showTramsReducer'\nimport { setMyTram } from '../reducers/myTramReducer'\nimport { setCenter, setZoom, setShowAlert, openSidebar, closeSidebar, toggleAlertVariant } from '../reducers/settingsReducer'\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet'\nimport { Button, Alert } from 'react-bootstrap'\nimport driverIcon, { stopIcon, myStopIcon, tramIcon, myTramIcon, locationIcon } from '../utils/icons'\n\nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  setCenter,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram,\n  settings,\n  setShowAlert,\n}) => {\n\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value)\n    let chosenTram = trams.find(tram => tram.VP.veh == e.target.value)\n    //setShowTrams([])\n    setMyTram(chosenTram)\n    if(!showTrams.map(tram => tram.VP.veh).includes(choseTram.VP.veh)){\n      setShowTrams(showTrams.concat(chose))\n    }\n    //setCenter({ lat: chosenTram.VP.lat, lng: chosenTram.VP.long })\n    //setZoom(16)\n\n  }\n\n  const popUp = tram => {\n    return (\n      <Popup\n        closeButton={true}\n        value={tram.VP.veh}\n        autoPan={false}\n      >\n        line:{tram.VP.desi}\n        <br />\n        vehicle:{tram.VP.veh}\n        <br />\n        speed:{(tram.VP.spd * 3.6).toFixed(2)} km/h\n        <br />\n        stop:{tram.VP.stop}\n        <br />\n        route:{tram.VP.route}\n        <br />\n        {tram.VP.dl > 0 ? 'ahead ' : 'lagging '} {Math.abs(tram.VP.dl)} seconds\n        <br />\n        {tram.VP.drst === 0 ? 'doors closed' : 'doors open'}\n        <br />\n        {(!myTram.VP || (myTram.VP && myTram.VP.veh !== tram.VP.veh)) && <Button value={tram.VP.veh} onClick={handleChooseTram}>CHOOSE</Button>}\n      </Popup>\n    )\n  }\n\n  const ShowChosenTrams = () => {\n\n    let tramsToShow = [...trams].filter(tram =>\n      showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh)\n    )\n    if (myTram.VP) {\n      tramsToShow = tramsToShow.filter(tram => tram.VP.veh !== myTram.VP.veh)\n    }\n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => (\n        <Marker\n          key={i}\n          icon={myTram.Vp ? myTramIcon : tramIcon}\n          position={{\n            lat: tram.VP.lat,\n            lng: tram.VP.long,\n          }}\n        >\n          {popUp(tram)}\n        </Marker>\n      ))\n    }\n  }\n\n  const showMyTram = () => {\n    if (myTram.VP) {\n      let myTramAlive = trams.find(tram => tram.VP.veh === myTram.VP.veh)\n      let halfWay = { lat: (myStop.lat +  myTramAlive.VP.lat)/2,\n        lng: (myStop.lon + myTramAlive.VP.long)/2 }\n      return (\n        <div>\n        <Marker\n          icon={myTramIcon}\n          position={{ lat: myTramAlive.VP.lat, lng: myTramAlive.VP.long }}\n        >\n          {popUp(myTramAlive)}\n        </Marker>\n        {/* <Marker\n        icon={locationIcon}\n        position={halfWay}\n      > \n      </Marker> */}\n      </div>\n      )\n    }\n  }\n\n  const showStops = () => {\n\n    return stops &&\n      stops.map((stop, i) => (\n        <Marker\n          onClick={() => setMyStop(stop)}\n          key={i}\n          icon={stop.id === myStop.id ? myStopIcon : stopIcon}\n          position={{ lat: stop.lat, lng: stop.lon }}\n        >\n          <Popup autoPan={false}>\n            <br /> {stop.name}\n            <br /> {stop.gtfsId}\n          </Popup>\n        </Marker>\n      ))\n  }\n\n  const style = settings.showSidebar ? { marginLeft: '20px' } : { marginLeft: '0' }\n\n  return (\n    <div\n      id='mapContainer'\n      style={style} >\n      {settings.showSidebarOpenButton && (\n        <Button\n          variant='light'\n          style={{\n            position: 'fixed',\n            top: 0,\n            left: 0,\n            zIndex: 1,\n            fontSize: 36,\n            marginTop: '4px',\n            display: settings.showSidebar ? 'none' : '',\n          }}\n          onClick={() => openSidebar()}\n        >\n          {settings.showSidebarOpenButton ? 'â˜°' : ''}\n        </Button>\n      )}\n        {!settings.showAlert && <Map\n        id='map'\n        center={settings.center}\n        zoom={settings.zoom}\n        onclick={() => closeSidebar()}\n        zoomControl={false}\n      >\n        <TileLayer\n          url='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        />\n        {ShowChosenTrams()}\n        {showStops()}\n        {/* showMyTram() */}\n        <Marker\n          icon={driverIcon}\n          position={{ lat: 60.170627, lng: 24.939946 }}\n        >\n          <Popup>\n            We are here! <br /> This is our position!\n          </Popup>\n        </Marker>\n      </Map>}  \n      <Alert id='alert' show={settings.showAlert} variant={settings.alertVariant ? 'danger' : 'warning'}>\n        <br /><br /><br /><br /><br />\n        <Alert.Heading>How's it going?!</Alert.Heading>\n        <p>\n          Duis mollis, est non commodo luctus \n        </p>\n        <hr />\n        <div className='d-flex justify-content-end'>\n          <Button onClick={() => setShowAlert(false)} variant='warning'>\n            Close me ya'll!\n          </Button>\n        </div>\n      </Alert>\n    </div>\n  )\n}\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    //showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    settings: state.settings,\n    myStop: state.myStop,\n    myTram: state.myTram,\n  }\n}\n\nconst mapDispatchToProps = {\n  setShowTrams,\n  setMyStop, setMyTram, setZoom, setCenter, setShowAlert, openSidebar, closeSidebar,\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LeafletMap)\n"]},"metadata":{},"sourceType":"module"}