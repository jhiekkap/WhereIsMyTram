{"ast":null,"code":"var _jsxFileName = \"/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { setShowTrams } from '../reducers/showTramsReducer';\nimport { setMyTram } from '../reducers/myTramReducer';\nimport { setCenter, setZoom, setShowAlert, openSidebar, closeSidebar, setLine } from '../reducers/settingsReducer';\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet';\nimport { Button, Alert } from 'react-bootstrap';\nimport driverIcon, { stopIcon, myStopIcon, tramIcon, myTramIcon, locationIcon } from '../utils/icons';\nimport { printDuration } from '../utils/helpers';\n\nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  setCenter,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram,\n  settings,\n  setShowAlert,\n  setLine\n}) => {\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value);\n    let chosenTram = trams.find(tram => tram.VP.veh == e.target.value); //setShowTrams([])\n\n    setMyTram(chosenTram);\n    setLine(chosenTram.VP.desi);\n\n    if (!showTrams.map(tram => tram.VP.veh).includes(chosenTram.VP.veh)) {\n      setShowTrams(showTrams.concat(chosenTram));\n    }\n\n    setCenter({\n      lat: chosenTram.VP.lat,\n      lng: chosenTram.VP.long\n    }); //setZoom(16)\n  };\n\n  const popUp = tram => {\n    return React.createElement(Popup, {\n      closeButton: true,\n      value: tram.VP.veh,\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46\n      },\n      __self: this\n    }, \"line:\", tram.VP.desi, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }), \"vehicle:\", tram.VP.veh, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 54\n      },\n      __self: this\n    }), \"speed:\", (tram.VP.spd * 3.6).toFixed(2), \" km/h\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }), \"stop:\", tram.VP.stop, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58\n      },\n      __self: this\n    }), \"route:\", tram.VP.route, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60\n      },\n      __self: this\n    }), tram.VP.dl > 0 ? 'ahead ' : 'lagging ', \" \", Math.abs(tram.VP.dl), \" seconds\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }), tram.VP.drst === 0 ? 'doors closed' : 'doors open', React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64\n      },\n      __self: this\n    }), (!myTram.VP || myTram.VP && myTram.VP.veh !== tram.VP.veh) && React.createElement(Button, {\n      value: tram.VP.veh,\n      onClick: handleChooseTram,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65\n      },\n      __self: this\n    }, \"CHOOSE\"));\n  };\n\n  const ShowChosenTrams = () => {\n    let tramsToShow = [...trams].filter(tram => showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh));\n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => React.createElement(Marker, {\n        key: i,\n        icon: myTram.VP && myTram.VP.veh === tram.VP.veh ? myTramIcon : tramIcon,\n        position: {\n          lat: tram.VP.lat,\n          lng: tram.VP.long\n        },\n        zIndex: 2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }, popUp(tram)));\n    }\n  };\n\n  const showStops = () => {\n    return stops && stops.map((stop, i) => React.createElement(Marker, {\n      onClick: () => setMyStop(stop),\n      key: i,\n      icon: stop.id === myStop.id ? myStopIcon : stopIcon,\n      position: {\n        lat: stop.lat,\n        lng: stop.lon\n      },\n      zIndex: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, React.createElement(Popup, {\n      autoPan: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }), \" \", stop.name, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }), \" \", stop.gtfsId)));\n  };\n\n  const style = settings.showSidebar ? {\n    marginLeft: '20px'\n  } : {\n    marginLeft: '0'\n  };\n  return React.createElement(\"div\", {\n    id: \"mapContainer\",\n    style: style,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, settings.showSidebarOpenButton && React.createElement(Button, {\n    id: \"sidebarButton\",\n    variant: \"light\",\n    style: {\n      display: settings.showSidebar ? 'none' : ''\n    },\n    onClick: () => openSidebar(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, settings.showSidebarOpenButton ? '☰' : ''), myTram && React.createElement(\"div\", {\n    id: \"distanceOnMap\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, settings.distance, \" m \", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }), settings.avgDuration && printDuration(settings.avgDuration)), !settings.showAlert && React.createElement(Map, {\n    id: \"map\",\n    center: settings.center,\n    zoom: settings.zoom,\n    onclick: () => closeSidebar(),\n    zoomControl: false,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(TileLayer, {\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    attribution: \"\\xA9 <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }), ShowChosenTrams(), showStops(), React.createElement(Marker, {\n    icon: driverIcon,\n    position: {\n      lat: 60.170627,\n      lng: 24.939946\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(Popup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"We are here! \", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }), \" This is our position!\"))), React.createElement(Alert, {\n    id: \"alert\",\n    show: settings.showAlert,\n    variant: settings.alertVariant ? 'danger' : 'warning',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(Alert.Heading, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, \"How's it going?!\"), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, \"Duis mollis, est non commodo luctus\"), React.createElement(\"hr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"d-flex justify-content-end\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: () => setShowAlert(false),\n    variant: \"warning\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, \"Close me ya'll!\"))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    //showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    settings: state.settings,\n    myStop: state.myStop,\n    myTram: state.myTram\n  };\n};\n\nconst mapDispatchToProps = {\n  setShowTrams,\n  setMyStop,\n  setMyTram,\n  setZoom,\n  setCenter,\n  setShowAlert,\n  openSidebar,\n  closeSidebar,\n  setLine\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LeafletMap);","map":{"version":3,"sources":["/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/ui/src/components/LeafletMap.js"],"names":["React","connect","setShowTrams","setMyTram","setCenter","setZoom","setShowAlert","openSidebar","closeSidebar","setLine","setMyStop","Map","Marker","Popup","TileLayer","Button","Alert","driverIcon","stopIcon","myStopIcon","tramIcon","myTramIcon","locationIcon","printDuration","LeafletMap","trams","showTrams","stops","myStop","myTram","settings","handleChooseTram","e","console","log","target","value","chosenTram","find","tram","VP","veh","desi","map","includes","concat","lat","lng","long","popUp","spd","toFixed","stop","route","dl","Math","abs","drst","ShowChosenTrams","tramsToShow","filter","i","showStops","id","lon","name","gtfsId","style","showSidebar","marginLeft","showSidebarOpenButton","display","distance","avgDuration","showAlert","center","zoom","alertVariant","mapStateToProps","state","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { setShowTrams } from '../reducers/showTramsReducer'\nimport { setMyTram } from '../reducers/myTramReducer'\nimport { setCenter, setZoom, setShowAlert, openSidebar, closeSidebar, setLine, } from '../reducers/settingsReducer'\nimport { setMyStop } from '../reducers/myStopReducer';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet'\nimport { Button, Alert } from 'react-bootstrap'\nimport driverIcon, { stopIcon, myStopIcon, tramIcon, myTramIcon, locationIcon,} from '../utils/icons'\nimport { printDuration } from '../utils/helpers'\n\nconst LeafletMap = ({\n  trams,\n  showTrams,\n  setShowTrams,\n  openSidebar,\n  closeSidebar,\n  setCenter,\n  setZoom,\n  stops,\n  myStop,\n  setMyStop,\n  myTram,\n  setMyTram,\n  settings,\n  setShowAlert,\n  setLine,\n}) => {\n\n  const handleChooseTram = e => {\n    console.log('valitse nro: ', e.target.value)\n    let chosenTram = trams.find(tram => tram.VP.veh == e.target.value)\n    //setShowTrams([])\n    setMyTram(chosenTram)\n    setLine(chosenTram.VP.desi)\n    if(!showTrams.map(tram => tram.VP.veh).includes(chosenTram.VP.veh)){\n      setShowTrams(showTrams.concat(chosenTram))\n    }\n    setCenter({ lat: chosenTram.VP.lat, lng: chosenTram.VP.long })\n    //setZoom(16)\n\n  }\n\n  const popUp = tram => {\n    return (\n      <Popup\n        closeButton={true}\n        value={tram.VP.veh}\n        autoPan={false}\n      >\n        line:{tram.VP.desi}\n        <br />\n        vehicle:{tram.VP.veh}\n        <br />\n        speed:{(tram.VP.spd * 3.6).toFixed(2)} km/h\n        <br />\n        stop:{tram.VP.stop}\n        <br />\n        route:{tram.VP.route}\n        <br />\n        {tram.VP.dl > 0 ? 'ahead ' : 'lagging '} {Math.abs(tram.VP.dl)} seconds\n        <br />\n        {tram.VP.drst === 0 ? 'doors closed' : 'doors open'}\n        <br />\n        {(!myTram.VP || (myTram.VP && myTram.VP.veh !== tram.VP.veh)) && <Button value={tram.VP.veh} onClick={handleChooseTram}>CHOOSE</Button>}\n      </Popup>\n    )\n  }\n\n  const ShowChosenTrams = () => {\n\n    let tramsToShow = [...trams].filter(tram =>\n      showTrams.map(tram => tram.VP.veh).includes(tram.VP.veh)\n    ) \n\n    if (showTrams) {\n      return tramsToShow.map((tram, i) => (\n        <Marker\n          key={i}\n          icon={myTram.VP && (myTram.VP.veh === tram.VP.veh) ? myTramIcon : tramIcon}\n          position={{\n            lat: tram.VP.lat,\n            lng: tram.VP.long,\n          }}\n          zIndex={2}\n        >\n          {popUp(tram)}\n        </Marker>\n      ))\n    }\n  }\n\n  const showStops = () => {\n\n    return stops &&\n      stops.map((stop, i) => (\n        <Marker\n          onClick={() => setMyStop(stop)}\n          key={i}\n          icon={stop.id === myStop.id ? myStopIcon : stopIcon}\n          position={{ lat: stop.lat, lng: stop.lon }}\n          zIndex={1}\n        >\n          <Popup autoPan={false}>\n            <br /> {stop.name}\n            <br /> {stop.gtfsId}\n          </Popup>\n        </Marker>\n      ))\n  }\n\n  const style = settings.showSidebar ? { marginLeft: '20px' } : { marginLeft: '0' }\n\n  return (\n    <div\n      id='mapContainer'\n      style={style} >\n      {settings.showSidebarOpenButton && (\n        <Button id='sidebarButton'\n          variant='light'\n          style={{display: settings.showSidebar ? 'none' : ''}}\n          onClick={() => openSidebar()}\n        >\n          {settings.showSidebarOpenButton ? '☰' : ''}\n        </Button>\n      )}\n      {myTram && <div id='distanceOnMap'>\n        {settings.distance} m <br/>{settings.avgDuration && printDuration(settings.avgDuration)}\n      </div>}\n\n        {!settings.showAlert && <Map\n        id='map'\n        center={settings.center}\n        zoom={settings.zoom}\n        onclick={() => closeSidebar()}\n        zoomControl={false}\n      >\n        <TileLayer\n          url='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        />\n        {ShowChosenTrams()}\n        {showStops()} \n        <Marker\n          icon={driverIcon}\n          position={{ lat: 60.170627, lng: 24.939946 }} \n        >\n          <Popup>\n            We are here! <br /> This is our position!\n          </Popup>\n        </Marker> \n      </Map>}  \n\n      <Alert id='alert' show={settings.showAlert} variant={settings.alertVariant ? 'danger' : 'warning'}>\n        <br /><br /><br /><br /><br />\n        <Alert.Heading>How's it going?!</Alert.Heading>\n        <p>\n          Duis mollis, est non commodo luctus \n        </p>\n        <hr />\n        <div className='d-flex justify-content-end'>\n          <Button onClick={() => setShowAlert(false)} variant='warning'>\n            Close me ya'll!\n          </Button>\n        </div>\n      </Alert>\n    </div>\n  )\n}\n\nconst mapStateToProps = state => {\n  return {\n    trams: state.trams,\n    showTrams: state.showTrams,\n    //showSidebar: state.showSidebar,\n    showSidebarOpenButton: state.showSidebarOpenButton,\n    stops: state.stops,\n    settings: state.settings,\n    myStop: state.myStop,\n    myTram: state.myTram,\n  }\n}\n\nconst mapDispatchToProps = {\n  setShowTrams, setMyStop, setMyTram, setZoom, setCenter, \n  setShowAlert, openSidebar, closeSidebar, setLine, \n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LeafletMap)\n"]},"metadata":{},"sourceType":"module"}