{"ast":null,"code":"import _slicedToArray from \"/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/src/LeafletMap.js\";\nimport React, { useState } from 'react';\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet';\nimport { subscribe } from 'mqtt-react';\nconst mapInitialCenter = {\n  lat: 60.19501135150039,\n  lng: 24.943557594049953\n};\n\nconst LeafletMap = props => {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        trams = _useState2[0],\n        setTrams = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        showTrams = _useState4[0],\n        setShowTrams = _useState4[1];\n\n  const MarkerFactory = () => {\n    let currentTrams = [];\n\n    for (let i = 0; i < trams.length; i++) {\n      let VP = props.data[i].VP;\n      currentTrams.push({\n        linja: VP.desi,\n        veh: VP.veh,\n        lat: VP.lat,\n        long: VP.long\n      });\n    }\n\n    return showcurrentTrams.map(tram => React.createElement(Marker, {\n      key: tram.veh + tram.linja,\n      position: {\n        lat: tram.lat,\n        lng: tram.long\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 27\n      },\n      __self: this\n    }, React.createElement(Popup, {\n      closeButton: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34\n      },\n      __self: this\n    }, tram.linja)));\n  };\n\n  let newData = props.data[0];\n\n  if (newData) {\n    let VP = newData.VP; //console.log(new Date())\n\n    if (!trams.map(tram => tram.veh).includes(VP.veh)) {\n      //console.log(new Date(), 'trams: ', trams.length)\n      setTrams(trams.concat({\n        linja: VP.desi,\n        veh: VP.veh,\n        lat: VP.lat,\n        long: VP.long\n      }));\n    } else {//console.log('hep', new Date())\n\n      /* let newTrams =  \n        trams.map(tram => tram.veh === VP.veh ? {\n          linja: VP.desi,\n          veh: VP.veh,\n          lat: VP.lat,\n          long: VP.long,\n        }: tram) \n        //console.log(newTrams)\n        setTrams(newTrams) */\n    }\n  } //console.log(trams)\n  //console.log(props.data)\n\n\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }, React.createElement(Map, {\n    id: \"mapid\",\n    center: mapInitialCenter,\n    zoom: 12,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74\n    },\n    __self: this\n  }, React.createElement(TileLayer, {\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    attribution: \"\\xA9 <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }), React.createElement(Marker, {\n    position: mapInitialCenter,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }, React.createElement(Popup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }, \"A pretty CSS3 popup.\", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }), \"Easily customizable.\")), MarkerFactory(trams)), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }));\n};\n\nexport default subscribe({\n  topic: '/hfp/v2/journey/ongoing/vp/tram/#'\n})(LeafletMap); //export default LeafletMap","map":{"version":3,"sources":["/Users/jarihiekkapelto/Desktop/MOOC/harjoitusTyoFullStack19/mytram/src/LeafletMap.js"],"names":["React","useState","Map","Marker","Popup","TileLayer","subscribe","mapInitialCenter","lat","lng","LeafletMap","props","trams","setTrams","showTrams","setShowTrams","MarkerFactory","currentTrams","i","length","VP","data","push","linja","desi","veh","long","showcurrentTrams","map","tram","newData","includes","concat","topic"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport { Map, Marker, Popup, TileLayer } from 'react-leaflet'\nimport { subscribe } from 'mqtt-react'\n\nconst mapInitialCenter = { lat: 60.19501135150039, lng: 24.943557594049953 }\n\n\n\nconst LeafletMap = props => {\n  const [trams, setTrams] = useState([])\n  const [showTrams, setShowTrams] = useState([])\n\n  const MarkerFactory = () => {\n    \n    let currentTrams = []\n    for(let i=0;i<trams.length;i++){\n      let VP = props.data[i].VP\n      currentTrams.push({\n        linja: VP.desi,\n        veh: VP.veh,\n        lat: VP.lat,\n        long: VP.long,\n      })\n    }\n  \n    return showcurrentTrams.map(tram => (\n      <Marker\n        key={tram.veh + tram.linja}\n        position={{\n          lat: tram.lat,\n          lng: tram.long,\n        }}\n      >\n        <Popup closeButton={false}>{tram.linja}</Popup>\n      </Marker>\n    ))\n  }\n\n    let newData = props.data[0]\n  if (newData) {\n    let VP = newData.VP\n    //console.log(new Date())\n    if (!trams.map(tram => tram.veh).includes(VP.veh)) {\n      //console.log(new Date(), 'trams: ', trams.length)\n      setTrams(\n        trams.concat({\n          linja: VP.desi,\n          veh: VP.veh,\n          lat: VP.lat,\n          long: VP.long,\n        })\n      )\n    } else {\n      //console.log('hep', new Date())\n      /* let newTrams =  \n        trams.map(tram => tram.veh === VP.veh ? {\n          linja: VP.desi,\n          veh: VP.veh,\n          lat: VP.lat,\n          long: VP.long,\n        }: tram) \n        //console.log(newTrams)\n        setTrams(newTrams) */\n    }\n  }  \n\n  //console.log(trams)\n  //console.log(props.data)\n\n \n\n  return (\n    <div className='App'>\n      <Map id='mapid' center={mapInitialCenter} zoom={12}>\n        <TileLayer\n          url='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        />\n        <Marker position={mapInitialCenter}>\n          <Popup>\n            A pretty CSS3 popup.\n            <br />\n            Easily customizable.\n          </Popup>\n        </Marker>\n        {MarkerFactory(trams)}\n      </Map>\n      <div>\n        {/* <ul>\n          {props.data.map(data => (\n            <li>öö{data.vp && data.vp.veh}</li>\n          ))}\n        </ul> */}\n      </div>\n    </div>\n  )\n}\n\n  export default subscribe({\n  topic: '/hfp/v2/journey/ongoing/vp/tram/#',\n})(LeafletMap) \n\n//export default LeafletMap\n"]},"metadata":{},"sourceType":"module"}