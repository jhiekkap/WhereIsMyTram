{"ast":null,"code":"'use strict';\n\nvar clear = require('es5-ext/array/#/clear'),\n    eIndexOf = require('es5-ext/array/#/e-index-of'),\n    setPrototypeOf = require('es5-ext/object/set-prototype-of'),\n    callable = require('es5-ext/object/valid-callable'),\n    validValue = require('es5-ext/object/valid-value'),\n    d = require('d'),\n    ee = require('event-emitter'),\n    Symbol = require('es6-symbol'),\n    iterator = require('es6-iterator/valid-iterable'),\n    forOf = require('es6-iterator/for-of'),\n    Iterator = require('./lib/iterator'),\n    isNative = require('./is-native-implemented'),\n    call = Function.prototype.call,\n    defineProperties = Object.defineProperties,\n    getPrototypeOf = Object.getPrototypeOf,\n    MapPoly;\n\nmodule.exports = MapPoly = function ()\n/*iterable*/\n{\n  var iterable = arguments[0],\n      keys,\n      values,\n      self;\n  if (!(this instanceof MapPoly)) throw new TypeError('Constructor requires \\'new\\'');\n\n  if (isNative && setPrototypeOf && Map !== MapPoly) {\n    self = setPrototypeOf(new Map(), getPrototypeOf(this));\n  } else {\n    self = this;\n  }\n\n  if (iterable != null) iterator(iterable);\n  defineProperties(self, {\n    __mapKeysData__: d('c', keys = []),\n    __mapValuesData__: d('c', values = [])\n  });\n  if (!iterable) return self;\n  forOf(iterable, function (value) {\n    var key = validValue(value)[0];\n    value = value[1];\n    if (eIndexOf.call(keys, key) !== -1) return;\n    keys.push(key);\n    values.push(value);\n  }, self);\n  return self;\n};\n\nif (isNative) {\n  if (setPrototypeOf) setPrototypeOf(MapPoly, Map);\n  MapPoly.prototype = Object.create(Map.prototype, {\n    constructor: d(MapPoly)\n  });\n}\n\nee(defineProperties(MapPoly.prototype, {\n  clear: d(function () {\n    if (!this.__mapKeysData__.length) return;\n    clear.call(this.__mapKeysData__);\n    clear.call(this.__mapValuesData__);\n    this.emit('_clear');\n  }),\n  delete: d(function (key) {\n    var index = eIndexOf.call(this.__mapKeysData__, key);\n    if (index === -1) return false;\n\n    this.__mapKeysData__.splice(index, 1);\n\n    this.__mapValuesData__.splice(index, 1);\n\n    this.emit('_delete', index, key);\n    return true;\n  }),\n  entries: d(function () {\n    return new Iterator(this, 'key+value');\n  }),\n  forEach: d(function (cb\n  /*, thisArg*/\n  ) {\n    var thisArg = arguments[1],\n        iterator,\n        result;\n    callable(cb);\n    iterator = this.entries();\n    result = iterator._next();\n\n    while (result !== undefined) {\n      call.call(cb, thisArg, this.__mapValuesData__[result], this.__mapKeysData__[result], this);\n      result = iterator._next();\n    }\n  }),\n  get: d(function (key) {\n    var index = eIndexOf.call(this.__mapKeysData__, key);\n    if (index === -1) return;\n    return this.__mapValuesData__[index];\n  }),\n  has: d(function (key) {\n    return eIndexOf.call(this.__mapKeysData__, key) !== -1;\n  }),\n  keys: d(function () {\n    return new Iterator(this, 'key');\n  }),\n  set: d(function (key, value) {\n    var index = eIndexOf.call(this.__mapKeysData__, key),\n        emit;\n\n    if (index === -1) {\n      index = this.__mapKeysData__.push(key) - 1;\n      emit = true;\n    }\n\n    this.__mapValuesData__[index] = value;\n    if (emit) this.emit('_add', index, key);\n    return this;\n  }),\n  size: d.gs(function () {\n    return this.__mapKeysData__.length;\n  }),\n  values: d(function () {\n    return new Iterator(this, 'value');\n  }),\n  toString: d(function () {\n    return '[object Map]';\n  })\n}));\nObject.defineProperty(MapPoly.prototype, Symbol.iterator, d(function () {\n  return this.entries();\n}));\nObject.defineProperty(MapPoly.prototype, Symbol.toStringTag, d('c', 'Map'));","map":null,"metadata":{},"sourceType":"script"}