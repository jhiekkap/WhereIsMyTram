{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer;\n/* Protocol - protocol constants */\n\n\nvar protocol = module.exports;\n/* Command code => mnemonic */\n\nprotocol.types = {\n  0: 'reserved',\n  1: 'connect',\n  2: 'connack',\n  3: 'publish',\n  4: 'puback',\n  5: 'pubrec',\n  6: 'pubrel',\n  7: 'pubcomp',\n  8: 'subscribe',\n  9: 'suback',\n  10: 'unsubscribe',\n  11: 'unsuback',\n  12: 'pingreq',\n  13: 'pingresp',\n  14: 'disconnect',\n  15: 'reserved'\n  /* Mnemonic => Command code */\n\n};\nprotocol.codes = {};\n\nfor (var k in protocol.types) {\n  var v = protocol.types[k];\n  protocol.codes[v] = k;\n}\n/* Header */\n\n\nprotocol.CMD_SHIFT = 4;\nprotocol.CMD_MASK = 0xF0;\nprotocol.DUP_MASK = 0x08;\nprotocol.QOS_MASK = 0x03;\nprotocol.QOS_SHIFT = 1;\nprotocol.RETAIN_MASK = 0x01;\n/* Length */\n\nprotocol.LENGTH_MASK = 0x7F;\nprotocol.LENGTH_FIN_MASK = 0x80;\n/* Connack */\n\nprotocol.SESSIONPRESENT_MASK = 0x01;\nprotocol.SESSIONPRESENT_HEADER = Buffer.from([protocol.SESSIONPRESENT_MASK]);\nprotocol.CONNACK_HEADER = Buffer.from([protocol.codes['connack'] << protocol.CMD_SHIFT]);\n/* Connect */\n\nprotocol.USERNAME_MASK = 0x80;\nprotocol.PASSWORD_MASK = 0x40;\nprotocol.WILL_RETAIN_MASK = 0x20;\nprotocol.WILL_QOS_MASK = 0x18;\nprotocol.WILL_QOS_SHIFT = 3;\nprotocol.WILL_FLAG_MASK = 0x04;\nprotocol.CLEAN_SESSION_MASK = 0x02;\nprotocol.CONNECT_HEADER = Buffer.from([protocol.codes['connect'] << protocol.CMD_SHIFT]);\n\nfunction genHeader(type) {\n  return [0, 1, 2].map(function (qos) {\n    return [0, 1].map(function (dup) {\n      return [0, 1].map(function (retain) {\n        var buf = new Buffer(1);\n        buf.writeUInt8(protocol.codes[type] << protocol.CMD_SHIFT | (dup ? protocol.DUP_MASK : 0) | qos << protocol.QOS_SHIFT | retain, 0, true);\n        return buf;\n      });\n    });\n  });\n}\n/* Publish */\n\n\nprotocol.PUBLISH_HEADER = genHeader('publish');\n/* Subscribe */\n\nprotocol.SUBSCRIBE_HEADER = genHeader('subscribe');\n/* Unsubscribe */\n\nprotocol.UNSUBSCRIBE_HEADER = genHeader('unsubscribe');\n/* Confirmations */\n\nprotocol.ACKS = {\n  unsuback: genHeader('unsuback'),\n  puback: genHeader('puback'),\n  pubcomp: genHeader('pubcomp'),\n  pubrel: genHeader('pubrel'),\n  pubrec: genHeader('pubrec')\n};\nprotocol.SUBACK_HEADER = Buffer.from([protocol.codes['suback'] << protocol.CMD_SHIFT]);\n/* Protocol versions */\n\nprotocol.VERSION3 = Buffer.from([3]);\nprotocol.VERSION4 = Buffer.from([4]);\n/* QoS */\n\nprotocol.QOS = [0, 1, 2].map(function (qos) {\n  return Buffer.from([qos]);\n});\n/* Empty packets */\n\nprotocol.EMPTY = {\n  pingreq: Buffer.from([protocol.codes['pingreq'] << 4, 0]),\n  pingresp: Buffer.from([protocol.codes['pingresp'] << 4, 0]),\n  disconnect: Buffer.from([protocol.codes['disconnect'] << 4, 0])\n};","map":null,"metadata":{},"sourceType":"script"}